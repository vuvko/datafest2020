# Сам себя сконвертируй!

## Введение

Предполагается рассказать про суть возникающей задачи: есть много фреймворков, которые активно используются для разработки и исследования моделей, а деплоить надо на чём-то другом.
Например, часто разработка ведётся в PyTorch или Keras, а деплоить надо в Tensorflow или TensorRT (можно и Caffe, но им уже никто не пользуется, и хорошо!).
Если смотреть туториалы, то всё выглядит просто, но на деле появляются много камней.

## Проблемы

Раздел предполагается в общем про описание проблем процесса конвертации и запуска модели в деплое: 

* несоответствие работы слоёв в разных фреймворках или отсутствие слоёв,
* сложно просчитать заранее время работы на target фреймворке,
* версионность модели для формирования тестов,
* можно что-нибудь ещё.

### Переход между фреймворками

1-2 слайда про общие проблемы переходов между различными фреймворками в общем случае, если берём не просто классификационную сеть.

### Оптимизированные фреймворки

1 слайд про особенность фреймворков типа TensorRT, OpenVINO, почему в них поддержка отстаёт.

### Сериализация

1 слайд на описание того, зачем нужно сериализовывать и версионировать модели.
1 слайд на то, как оно устраивается в популярных фреймворках.

## ONNX

Раздел про то, почему лучше использовать ONNX как формат передачи и сохранения моделей.
Особенности работы с ним, и когда не надо через него.

### Что решает?

2 слайда на рассказ как ONNX решает проблему сериализации и почему через него сейчас самое универсальное (потому что много конвертеров).

### Почему не TensorFlow?

Или на самом деле любой другой фреймворк со статическим графом.
Потому что так сложилось.
Ну ещё потому что ONNX решает только задачу описания модели (причём не обязательно только нейросети), а TF в дополнении кучу всего другого.
И команда tensorflow не очень чесалась писать конвертеры из какого-нибудь chainer или mxnet, да и того же pytorch.

2 слайда

### Почему не другие конвертаторы?

1 слайд про существующие конвертаторы, и их покрытие, частоту изменений, и т.п.

### Конвертация

1 слайд кратко про особенности конвертации: смотрите список поддерживаемых слоёв, и их параметров.
1 слайд про opset'ы и проблемы невозожности их смешивать.
Нужно ещё про что-то рассказать.

2 слайда кейса из PyTorch в ONNX (RetinaFace и ATNN).

1 слайд кейса из MxNet в TensorFlow.

### Когда не надо 

* Когда разработка и деплой на едином фреймворке и есть нормальная сериализация.
* Нет нормальной конвертации через ONNX, но есть нормальная конвертация напрямую (Tensorflow -> TFLite).

## Заключение 

### Как поступать с моделями?

* О конвертации надо думать на этапе постановке задачи.
* Если внутри одной платформы, то радостно забываем про боль.
* Скорее всено нужно из какого-то PyTorch, здесь помним про особенности конвертатора.
* Используем ONNX для сериализации и передачи моделей.

### Коротко про мобильники

* Есть TFLite и CoreML, но там есть проблемы с конвертацией.
* Если нет необходимости ужиматься в 5-10б приложения, то можно использовать какой-нибудь ONNXRuntime.

### Что не рассматривалось

* RNN, там статические графы не умеют в RNN
* Деревья, там свои особенности (treelite)
